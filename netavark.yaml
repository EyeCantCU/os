# Generated from https://git.alpinelinux.org/aports/plain/community/netavark/APKBUILD
package:
  name: netavark
  version: 1.10.3
  epoch: 0
  description: Container network stack
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - build-base
      - busybox
      - go-md2man
      - protoc
      - rust

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/containers/netavark
      tag: v${{package.version}}
      expected-commit: d9f9fdc116ea3ed72a6eb4e59da33bf5d7c60b38

  - runs: |
      cargo fetch
      cargo build --release --frozen --bin netavark

      go-md2man -in docs/netavark.1.md -out docs/netavark.1

      install -Dm755 target/release/netavark \
        -t ${{targets.destdir}}/usr/libexec/podman/
      install -Dm644 docs/netavark.1 \
        -t ${{targets.destdir}}/usr/share/man/man1/

  - uses: strip

subpackages:
  - name: netavark-doc
    pipeline:
      - uses: split/manpages
    description: netavark manpages

update:
  enabled: true
  github:
    identifier: containers/netavark
    use-tag: true
    strip-prefix: v
